# Git å·¥ä½œæµä¸åˆ†æ”¯ç®¡ç†æŒ‡å—

ä¸ºäº†ç¡®ä¿ CI/CD æµç¨‹çš„ç¨³å®šæ€§å’Œä»£ç è´¨é‡ï¼Œä¸¥æ ¼æ‰§è¡Œ Git Flow å·¥ä½œæµå¹¶å¯¹å…³é”®åˆ†æ”¯å®æ–½ä¿æŠ¤æ˜¯è‡³å…³é‡è¦çš„ã€‚

## 1. åˆ†æ”¯æ¨¡å‹ (Git Flow)

æœ¬é¡¹ç›®é‡‡ç”¨æ ‡å‡†çš„ Git Flow æ¨¡å‹ï¼Œå„åˆ†æ”¯èŒè´£å¦‚ä¸‹ï¼š

| åˆ†æ”¯ | ç±»å‹ | è¯´æ˜ | æƒé™ |
| :--- | :--- | :--- | :--- |
| **`master`** | é•¿æœŸåˆ†æ”¯ | **ç”Ÿäº§ç¯å¢ƒä»£ç **ã€‚å¯¹åº”çº¿ä¸Šç‰ˆæœ¬ï¼Œæå…¶ç¨³å®šã€‚ | ğŸ”’ **é”å®š** (ä»…å…è®¸ Merge Request) |
| **`develop`** | é•¿æœŸåˆ†æ”¯ | **å¼€å‘ä¸»å¹²**ã€‚åŒ…å«æœ€æ–°å®Œæˆçš„åŠŸèƒ½ï¼Œå¯¹åº”æµ‹è¯•ç¯å¢ƒã€‚ | ğŸ”’ **é”å®š** (ä»…å…è®¸ Merge Request) |
| `feature/*` | çŸ­æœŸåˆ†æ”¯ | **æ–°åŠŸèƒ½å¼€å‘**ã€‚ä» develop åˆ‡å‡ºï¼Œå®Œæˆååˆå¹¶å› developã€‚ | ğŸ”“ å¼€æ”¾ (å¼€å‘äººå‘˜è‡ªç”± Push) |
| `release/*` | çŸ­æœŸåˆ†æ”¯ | **å‘å¸ƒå‡†å¤‡**ã€‚ä» develop åˆ‡å‡ºï¼Œå†»ç»“åŠŸèƒ½ï¼Œä¿®å¤ Bugï¼Œå®Œæˆååˆå¹¶å› master å’Œ developã€‚ | ğŸ”“ å¼€æ”¾ (Release è´Ÿè´£äºº) |
| `hotfix/*` | çŸ­æœŸåˆ†æ”¯ | **ç´§æ€¥ä¿®å¤**ã€‚ä» master åˆ‡å‡ºï¼Œä¿®å¤çº¿ä¸Š Bugï¼Œå®Œæˆååˆå¹¶å› master å’Œ developã€‚ | ğŸ”“ å¼€æ”¾ (Hotfix è´Ÿè´£äºº) |

## 2. ä¸ºä»€ä¹ˆè¦â€œé”â€åˆ†æ”¯ï¼Ÿ

â€œé”èµ·æ¥â€å³å¯ç”¨ **åˆ†æ”¯ä¿æŠ¤ (Branch Protection)**ï¼Œä¸»è¦ç›®çš„æœ‰ä¸‰ï¼š

1.  **ä¿è¯æ„å»ºé€šè¿‡**: é˜²æ­¢å°†æ— æ³•ç¼–è¯‘æˆ–æµ‹è¯•å¤±è´¥çš„ä»£ç ç›´æ¥æ¨é€åˆ°ä¸»å¹²ï¼Œç ´å CI/CD æµæ°´çº¿ã€‚
2.  **å¼ºåˆ¶ä»£ç å®¡æŸ¥ (Code Review)**: å¿…é¡»é€šè¿‡ Merge Request (MR) / Pull Request (PR) æµç¨‹ï¼Œç»è¿‡ä»–äºº Review åæ‰èƒ½åˆå¹¶ã€‚
3.  **æƒé™æ§åˆ¶**: é˜²æ­¢è¯¯æ“ä½œï¼ˆå¦‚ `git push -f`ï¼‰è¦†ç›–å†å²è®°å½•ã€‚

## 3. å¦‚ä½•è®¾ç½®åˆ†æ”¯ä¿æŠ¤

æ ¹æ®æ‚¨ä½¿ç”¨çš„ä»£ç æ‰˜ç®¡å¹³å°ï¼Œè¯·å‚è€ƒä»¥ä¸‹è®¾ç½®æ­¥éª¤ï¼š

### 3.1 GitHub

1.  è¿›å…¥ä»“åº“é¡µé¢ -> **Settings** -> **Branches**ã€‚
2.  ç‚¹å‡» **Add branch protection rule**ã€‚
3.  **Branch name pattern**: è¾“å…¥ `master` (å®ŒæˆååŒæ ·è®¾ç½® `develop`)ã€‚
4.  å‹¾é€‰ä»¥ä¸‹å…³é”®é€‰é¡¹ï¼š
    *   **Require a pull request before merging**: å¼ºåˆ¶èµ° PR æµç¨‹ã€‚
    *   **Require status checks to pass before merging**: å‹¾é€‰ Jenkins çš„ CI ä»»åŠ¡ï¼ˆå¦‚ `continuous-integration/jenkins/pr-merge`ï¼‰ï¼Œç¡®ä¿æµ‹è¯•é€šè¿‡æ‰èƒ½åˆå¹¶ã€‚
    *   **Do not allow bypassing the above settings**: ç¦æ­¢ç®¡ç†å‘˜ç»•è¿‡è§„åˆ™ã€‚
5.  ç‚¹å‡» **Create**ã€‚

### 3.2 GitLab

1.  è¿›å…¥ä»“åº“é¡µé¢ -> **Settings** -> **Repository** -> **Protected branches**ã€‚
2.  **Branch**: é€‰æ‹© `master` (å®ŒæˆååŒæ ·è®¾ç½® `develop`)ã€‚
3.  **Allowed to merge**: é€‰æ‹© `Maintainers` (æˆ–æŒ‡å®šè§’è‰²)ã€‚
4.  **Allowed to push**: é€‰æ‹© **No one** (å…³é”®ï¼è¿™å°±ç¦æ­¢äº†ç›´æ¥ Push)ã€‚
5.  ç‚¹å‡» **Protect**ã€‚

### 3.3 Gitea / Gogs

1.  è¿›å…¥ä»“åº“ -> **è®¾ç½®** -> **åˆ†æ”¯**ã€‚
2.  **æ·»åŠ åˆ†æ”¯ä¿æŠ¤**: è¾“å…¥ `master`ã€‚
3.  å‹¾é€‰ **å¯ç”¨åˆ†æ”¯ä¿æŠ¤**ã€‚
4.  å‹¾é€‰ **ç¦æ­¢ç›´æ¥æ¨é€** (Disable Push)ã€‚
5.  å‹¾é€‰ **éœ€è¦åˆå¹¶è¯·æ±‚** (Require Pull Request)ã€‚

## 4. å¼€å‘äººå‘˜æ—¥å¸¸æ“ä½œ

åœ¨åˆ†æ”¯è¢«é”å®šåï¼Œå¼€å‘äººå‘˜çš„æ—¥å¸¸æµç¨‹å˜ä¸ºï¼š

1.  **æ‹‰å–æœ€æ–°ä»£ç **: `git checkout develop && git pull`
2.  **åˆ›å»ºåŠŸèƒ½åˆ†æ”¯**: `git checkout -b feature/my-feature`
3.  **å¼€å‘å¹¶æäº¤**: `git add . && git commit -m "feat: ..."`
4.  **æ¨é€åˆ°è¿œç¨‹**: `git push origin feature/my-feature`
5.  **å‘èµ·åˆå¹¶è¯·æ±‚**: åœ¨ç½‘é¡µç«¯å‘èµ· MR/PRï¼Œè¯·æ±‚åˆå¹¶åˆ° `develop`ã€‚
6.  **ç­‰å¾… CI é€šè¿‡**: Jenkins ä¼šè‡ªåŠ¨è¿è¡Œæµ‹è¯•ã€‚
7.  **ä»£ç å®¡æŸ¥**: åŒäº‹ Review ä»£ç å¹¶æ‰¹å‡†ã€‚
8.  **åˆå¹¶**: ç‚¹å‡» Merge æŒ‰é’®ã€‚
